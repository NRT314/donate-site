<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>NRT Donate</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    button { padding: 10px; font-size: 16px; margin-top: 1rem; cursor: pointer; }
    input { padding: 5px; width: 100px; }
    #status { margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>–û –ø—Ä–æ–µ–∫—Ç–µ</h2>
  <p>–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–º –≤—ã –¥–æ–≤–µ—Ä—è–µ—Ç–µ. –ó–∞ –∫–∞–∂–¥–æ–µ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Ç–æ–∫–µ–Ω—ã <strong>NRT</strong>, –∫–æ—Ç–æ—Ä—ã–µ –≤ –±—É–¥—É—â–µ–º –¥–∞–¥—É—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ DAO-—Å–æ–æ–±—â–µ—Å—Ç–≤–µ.</p>

  <h3>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</h3>
  <button id="connectBtn">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫</button>
  <p id="walletAddress"></p>

  <h3>–°–¥–µ–ª–∞—Ç—å –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ</h3>
  <p>–°—É–º–º–∞ (–≤ USDT): <input id="amount" type="number" value="0.03" step="0.01" /></p>
  <button id="donateBtn">üí∏ –ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å</button>
  <p id="status"></p>

  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <script>
    const CONTRACT_ADDRESS = "0x875eB740603Cd0eAE03caa99Dd2d0f23BE9B6BF5"; // –≤–∞—à –∫–æ–Ω—Ç—Ä–∞–∫—Ç
    const USDT_ADDRESS = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F"; // USDT –≤ —Å–µ—Ç–∏ Polygon

    const ABI = [
      "function donate(address token, address[] recipients, uint256[] amounts) external"
    ];

    const RECIPIENTS = [
      "0xc0F467567570AADa929fFA115E65bB39066e3E42" // –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∞–¥—Ä–µ—Å
    ];

    let provider;
    let signer;

    const connectBtn = document.getElementById("connectBtn");
    const donateBtn = document.getElementById("donateBtn");
    const walletAddressElem = document.getElementById("walletAddress");
    const statusElem = document.getElementById("status");

    connectBtn.onclick = async () => {
      if (!window.ethereum) {
        alert("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask –∏–ª–∏ Rabby");
        return;
      }
      try {
        provider = new ethers.BrowserProvider(window.ethereum);
        const accounts = await provider.send("eth_requestAccounts", []);
        const addr = accounts[0];
        walletAddressElem.innerText = "–ö–æ—à–µ–ª—ë–∫: " + addr;
        signer = await provider.getSigner();
        connectBtn.disabled = true;
      } catch (e) {
        alert("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞: " + e.message);
      }
    };

    donateBtn.onclick = async () => {
      if (!signer) {
        alert("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫");
        return;
      }
      const amount = parseFloat(document.getElementById("amount").value);
      if (!amount || amount <= 0) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É");
        return;
      }

      try {
        const tokenContract = new ethers.Contract(USDT_ADDRESS, [
          "function approve(address spender, uint256 amount) public returns (bool)",
          "function decimals() view returns (uint8)"
        ], signer);

        const decimals = await tokenContract.decimals();
        const donationAmount = ethers.parseUnits(amount.toString(), decimals);

        statusElem.innerText = "‚è≥ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ –∫–æ—à–µ–ª—å–∫–µ (approve)...";
        const approveTx = await tokenContract.approve(CONTRACT_ADDRESS, donationAmount);
        await approveTx.wait();

        const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        statusElem.innerText = "‚è≥ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ –∫–æ—à–µ–ª—å–∫–µ (donate)...";
        const tx = await contract.donate(USDT_ADDRESS, RECIPIENTS, [donationAmount]);
        await tx.wait();

        statusElem.innerText = "‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –¥–æ–Ω–∞—Ç!";
      } catch (err) {
        statusElem.innerText = "";
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–Ω–∞—Ç–µ: " + err.message);
      }
    };
  </script>
</body>
</html>
